<div class="relative flex-shrink-0">
  <button
    mat-button
    [matMenuTriggerFor]="categoriesMenu"
    class="flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 shadow-sm"
  >
    <mat-icon class="!text-xl !w-5 !h-5 text-blue-600">apps</mat-icon>
    <span>Categories</span>
    <mat-icon class="!text-base !w-4 !h-4 text-gray-500">expand_more</mat-icon>
  </button>

  <mat-menu #categoriesMenu="matMenu" class="categories-mat-menu">
    @for (category of categories(); track category.id) {
      @if (category.children && category.children.length > 0) {
        <button
          mat-menu-item
          [matMenuTriggerFor]="submenu"
          (click)="categorySelect.emit(category.slug)"
          class="!flex !items-center !gap-3 !px-4 !py-3 !min-h-0 hover:!bg-blue-50 hover:!text-blue-700 transition-colors duration-150 group"
        >
          <mat-icon class="!text-xl !w-5 !h-5 text-gray-500 group-hover:text-blue-600">shopping_bag</mat-icon>
          <span class="flex-1 text-sm font-medium">{{ category.name }}</span>
        </button>

        <mat-menu #submenu="matMenu">
          <div class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50 border-b border-gray-200">
            {{ category.name }}
          </div>
          @for (subcategory of category.children; track subcategory.id) {
            <button
              mat-menu-item
              (click)="categorySelect.emit(subcategory.slug)"
              class="!flex !items-center !gap-3 !px-4 !py-2.5 !min-h-0 hover:!bg-blue-50 hover:!text-blue-700 transition-colors duration-150 group"
            >
              <mat-icon class="!text-base !w-4 !h-4 text-gray-400 group-hover:text-blue-600">label</mat-icon>
              <span class="text-sm">{{ subcategory.name }}</span>
            </button>
          }
        </mat-menu>
      } @else {
        <button
          mat-menu-item
          (click)="categorySelect.emit(category.slug)"
          class="!flex !items-center !gap-3 !px-4 !py-3 !min-h-0 hover:!bg-blue-50 hover:!text-blue-700 transition-colors duration-150 group"
        >
          <mat-icon class="!text-xl !w-5 !h-5 text-gray-500 group-hover:text-blue-600">shopping_bag</mat-icon>
          <span class="flex-1 text-sm font-medium">{{ category.name }}</span>
        </button>
      }
    }
  </mat-menu>
</div>
