@if (collection(); as collectionData) {
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
    <!-- Breadcrumbs and Header -->
    <nav class="bg-white/80 backdrop-blur-sm shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="flex items-center justify-between gap-4 flex-wrap">
          <ui-breadcrumb [breadcrumbs]="collectionData.breadcrumbs"></ui-breadcrumb>
          <div class="flex items-center gap-3">
            <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 tracking-tight">
              {{ collectionData.name }}
            </h1>
            @if (collectionData.children && collectionData.children.length > 0) {
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                {{ collectionData.children.length }} subcategories
              </span>
            }
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content with Sidebar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">

      <!-- Layout with Sidebar -->
      <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
        <!-- Sticky Sidebar -->
        @if (collectionSlug()) {
          <aside class="w-full lg:w-64 flex-shrink-0 order-2 lg:order-1">
            <div class="lg:sticky lg:top-24">
              <app-product-facets></app-product-facets>
            </div>
          </aside>
        }

        <!-- Main Content Area -->
        <div class="flex-1 min-w-0 order-1 lg:order-2">
          <!-- Categories Grid with better spacing -->
          @if (collectionData.children && collectionData.children.length > 0) {
            <div class="mb-8">
              <ui-collections-layout [collection]="collectionData"></ui-collections-layout>
            </div>
          }

          <!-- Products section with header -->
          <div class="space-y-4">

            <div class="flex items-center justify-between pb-4 border-b border-gray-200">
              <h2 class="text-xl font-semibold text-gray-900">Products</h2>
              <div class="flex items-center gap-2">
                <label for="sort-select" class="text-sm text-gray-600 font-medium">Sort by:</label>
                <select
                  id="sort-select"
                  (change)="handleSortChange($event)"
                  class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                >
                  <option value="">Default</option>
                  <option value="price-asc">Price: Low to High</option>
                  <option value="price-desc">Price: High to Low</option>
                  <option value="name-asc">Name: A to Z</option>
                  <option value="name-desc">Name: Z to A</option>
                </select>
              </div>
            </div>

            <product-container
              [products]="products()"
            ></product-container>
          </div>
        </div>
      </div>
    </div>
  </div>
} @else {
  <!-- Enhanced Loading State -->
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center">
    <div class="text-center">
      <div class="relative">
        <div class="animate-spin rounded-full h-16 w-16 border-4 border-gray-200 border-t-blue-600 mx-auto"></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="h-8 w-8 bg-blue-50 rounded-full"></div>
        </div>
      </div>
      <p class="mt-6 text-lg font-medium text-gray-700">Loading category...</p>
      <p class="mt-2 text-sm text-gray-500">Please wait</p>
    </div>
  </div>
}

